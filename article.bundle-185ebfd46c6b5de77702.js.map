{"version":3,"sources":["webpack:///./src/js/pages/article/article.js","webpack:///./src/js/pages/article/article-controller.js"],"names":["Article","Component","constructor","super","this","onDelete","props","controller","deleteArticle","setFollowing","setFavorite","onSubmit","e","preventDefault","form","submit","renderArticleMeta","article","currentUser","pending","className","author","username","to","slug","onClick","disabled","has","classNames","following","favorited","favoritesCount","render","comments","deleteComment","title","dangerouslySetInnerHTML","__html","markdown","toHTML","body","type","inputClassName","placeholder","inputProps","rows","src","image","length","map","comment","i","key","encodeURIComponent","longDate","createdAt","bind","id","propTypes","PropTypes","object","isRequired","ctrl","router","params","get","articlesPromise","getArticle","then","getComments","init","transitionTo","Form","actions","postComment","getResult","articleApi","setComments","userController","articleController","isAuthenticated","addComment","clear","commentId"],"mappings":"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","file":"article.bundle-185ebfd46c6b5de77702.js","sourcesContent":["import React, {Component} from 'react';\nimport PropTypes from 'prop-types';\nimport {Link} from 'crizmas-router';\nimport {Input} from 'crizmas-components';\nimport {markdown} from 'markdown';\nimport classNames from 'classnames';\n\nimport ArticleAuthor from '../../components/article-author';\nimport TagList from '../../components/tag-list';\nimport {longDate} from '../../date-utils';\n\nexport default class Article extends Component {\n  constructor() {\n    super();\n\n    this.onDelete = () => {\n      this.props.controller.deleteArticle();\n    };\n\n    this.setFollowing = () => {\n      this.props.controller.setFollowing();\n    };\n\n    this.setFavorite = () => {\n      this.props.controller.setFavorite();\n    };\n\n    this.onSubmit = (e) => {\n      e.preventDefault();\n      this.props.controller.form.submit();\n    };\n  }\n\n  renderArticleMeta() {\n    const {article, currentUser, pending} = this.props.controller;\n\n    return <div className=\"article-meta\">\n      <ArticleAuthor article={article} />\n\n      {article.author.username === currentUser.username && <span>\n        <Link\n          to={`/editor/${article.slug}`}\n          className=\"btn btn-sm btn-outline-secondary\">\n          <i className=\"ion-edit\" />&nbsp;\n          Edit Article\n        </Link>\n        &nbsp;\n        <button\n          className=\"btn btn-sm btn-outline-danger\"\n          onClick={this.onDelete}\n          disabled={pending.has('deleteArticle')}>\n          <i className=\"ion-trash-a\" />&nbsp;\n          Delete Article\n        </button>\n      </span>}\n      {article.author.username !== currentUser.username && <span>\n        <button\n          className={classNames('btn btn-sm', {\n            'btn-secondary': article.author.following,\n            'btn-outline-secondary': !article.author.following\n          })}\n          onClick={this.setFollowing}\n          disabled={pending.has('setFollowing')}>\n          <i className=\"ion-plus-round\" />&nbsp;\n          {article.author.following ? 'Unfollow' : 'Follow'} {article.author.username}\n        </button>\n        &nbsp;\n        <button\n          className={classNames('btn btn-sm', {\n            'btn-primary': article.favorited,\n            'btn-outline-primary': !article.favorited\n          })}\n          onClick={this.setFavorite}\n          disabled={pending.has('setFavorite')}>\n          <i className=\"ion-heart\" />&nbsp;\n          {article.favorited ? 'Unfavorite Article' : 'Favorite Article'}\n          ({article.favoritesCount})\n        </button>\n      </span>}\n    </div>;\n  }\n\n  render() {\n    const {article, article: {comments}, currentUser, form, deleteComment} = this.props.controller;\n\n    return <div className=\"article-page\">\n      <div className=\"banner\">\n        <div className=\"container\">\n          <h1>{article.title}</h1>\n\n          {this.renderArticleMeta()}\n        </div>\n      </div>\n\n      <div className=\"container page\">\n        <div className=\"row article-content\">\n          <div className=\"col-md-12\">\n            <div dangerouslySetInnerHTML={{__html: markdown.toHTML(article.body)}} />\n            <TagList article={article} />\n          </div>\n        </div>\n\n        <hr />\n\n        <div className=\"article-actions\">\n          {this.renderArticleMeta()}\n        </div>\n\n        <div className=\"row\">\n          <div className=\"col-xs-12 col-md-8 offset-md-2\">\n            <form className=\"card comment-form\" onSubmit={this.onSubmit}>\n              <div className=\"card-block\">\n                <Input\n                  type=\"textarea\"\n                  inputClassName=\"form-control\"\n                  placeholder=\"Write a comment...\"\n                  inputProps={{rows: \"3\"}}\n                  {...form} />\n              </div>\n              <div className=\"card-footer\">\n                <img\n                  src={currentUser.image}\n                  className=\"comment-author-img\" />\n                <button className=\"btn btn-sm btn-primary\">Post Comment</button>\n              </div>\n            </form>\n\n            {comments && !!comments.length && comments.map((comment, i) => <div\n              key={i}\n              className=\"card\">\n              <div className=\"card-block\">\n                <p className=\"card-text\">\n                  {comment.body}\n                </p>\n              </div>\n              <div className=\"card-footer\">\n                <Link\n                  to={`/@${encodeURIComponent(comment.author.username)}`}\n                  className=\"comment-author\">\n                  <img src={comment.author.image} className=\"comment-author-img\" />\n                </Link>\n                &nbsp;&nbsp;\n                <Link\n                  to={`/@${encodeURIComponent(comment.author.username)}`}\n                  className=\"comment-author\">{comment.author.username}</Link>\n                <span className=\"date-posted\">{longDate(comment.createdAt)}</span>\n                {comment.author.username === currentUser.username && <span className=\"mod-options\">\n                  <i className=\"ion-trash-a\" onClick={deleteComment.bind(null, comment.id)} />\n                </span>}\n              </div>\n            </div>)}\n          </div>\n        </div>\n      </div>\n    </div>;\n  }\n}\n\nArticle.propTypes = {\n  controller: PropTypes.object.isRequired\n};\n","import {controller} from 'crizmas-mvc';\nimport Form from 'crizmas-form';\n\nimport * as articleApi from '../../api/article';\nimport {currentUser} from '../../models/user';\nimport {Article} from '../../models/article';\nimport router from '../../router';\nimport userController from '../../controllers/user';\nimport articleController from '../../controllers/article';\n\nexport default controller(function ArticleController() {\n  const ctrl = {\n    article: null,\n    currentUser,\n    form: null\n  };\n\n  ctrl.onEnter = () => {\n    const slug = router.params.get('slug');\n    const articlesPromise = ctrl.getArticle(slug);\n\n    articlesPromise.then(() => {\n      ctrl.getComments(slug);\n    });\n\n    return articlesPromise.then(\n      init,\n\n      () => {\n        router.transitionTo('/');\n\n        return false;\n      }\n    );\n  };\n\n  const init = () => {\n    ctrl.form = new Form({\n      actions: {\n        submit: () => {\n          ctrl.postComment(ctrl.form.getResult());\n        }\n      }\n    });\n  };\n\n  ctrl.getArticle = (slug) => {\n    return articleApi.getArticle({slug}).then(({article}) => {\n      ctrl.article = new Article(article);\n    });\n  };\n\n  ctrl.getComments = (slug) => {\n    return articleApi.getArticleComments({slug}).then(({comments}) => {\n      ctrl.article.setComments(comments);\n    });\n  };\n\n  ctrl.deleteArticle = () => {\n    return articleApi.deleteArticle({slug: ctrl.article.slug}).then(() => {\n      router.transitionTo('/');\n    });\n  };\n\n  ctrl.setFollowing = () => {\n    return userController.setFollowing(ctrl.article.author);\n  };\n\n  ctrl.setFavorite = () => {\n    return articleController.setFavorite(ctrl.article);\n  };\n\n  ctrl.postComment = (comment) => {\n    if (!currentUser.isAuthenticated) {\n      return router.transitionTo('/register');\n    }\n\n    return articleApi.postComment({slug: ctrl.article.slug, comment}).then(({comment}) => {\n      ctrl.article.addComment(comment);\n      ctrl.form.clear();\n    });\n  };\n\n  ctrl.deleteComment = (commentId) => {\n    return articleApi.deleteComment({slug: ctrl.article.slug, commentId}).then(() => {\n      ctrl.article.deleteComment(commentId);\n    });\n  };\n\n  return ctrl;\n});\n"],"sourceRoot":""}